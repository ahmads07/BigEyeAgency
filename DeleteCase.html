<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Delete Case</title>
    <link rel="stylesheet" href="assets/css/main.css" />

    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
    </script>

    <script>
        $(document).ready(function () {
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://bigeye5.herokuapp.com/api/cases/',
                success: function (data) {
                    // location.reload();
                    console.log(data);
                    i = 0;
                    while (i < data.length) {
                        case1 = data[i];
                        if (case1.Status == "Closed"){
                            $("#case_id_input").append("<option value='" +case1.CaseID + "'>" +case1.Description + "</option>");
                        }
                        i = i + 1;
                    }

                    $("#case_id_input").change(function () {
                        caseID = $("#case_id_input").val()
                        getCaseInfo(caseID);
                    });

                    $("#del_case_but").click(function () {
                        caseID = $("#case_id_input").val()
                        deleteCase(caseID);
                    });


                },
                error: function (err) {
                    console.log(err);
                }
            });
        });


        function getCaseInfo(CaseID) {
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://bigeye5.herokuapp.com/api/cases/' + CaseID,
                success: function (data) {
                    // location.reload();
                    $("#case_id").text(data.CaseID);
                    $("#case_description").text(data.Description);
                    $("#case_date").text(data.CaseDate);
                    $("#case_status").text(data.Status);
                    console.log(data);
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function deleteCase(CaseID){
            $.ajax({
                type: 'DELETE',
                dataType: 'JSON',
                url: 'https://bigeye5.herokuapp.com/api/cases/' + CaseID,
                success: function (data) {
                    alert('case deleted successfully');
                    location.reload();
                },
                error: function (err) {
                    console.log(err);
                    errors = JSON.parse(err.responseText);
                    console.log(errors);
                    $("#case_id_input_err").text(errors.name);
                }
            });
        }



    </script>
</head>
<body>
<form onsubmit="return false">
    <h2><u>Delete Case</u></h2>
    <p><label> Cases: </label>
        <select id="case_id_input">
            <option value="">Select one</option>
        </select>
    </p>
    <table>
        <tr>
            <td>ID:</td>
            <td id="case_id"></td>
        </tr>
        <tr>
            <td>Description:</td>
            <td id="case_description"></td>
        </tr>
        <tr>
            <td>Date:</td>
            <td id="case_date"></td>
        </tr>
        <tr>
            <td>Status:</td>
            <td id="case_status"></td>
        </tr>
    </table>

    <button class = "button fit special" type="button" id="del_case_but">Delete Case</button>
    <a class = "button fit" href="MainMenu.html">Return</a>

</form>
</body>
</html>
